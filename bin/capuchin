#!/usr/bin/env ruby
require 'capuchin'
require 'capuchin/shell'

require 'commander/import'

program :name, 'capuchin'
program :version, Capuchin::VERSION
program :description, 'Capuchin is a tool for writing email newsletters with Markdown'
program :help, 'Author', 'Matt Swanson <matt@mdswanson.com>'

CONFIG_FILE = "_config.yml"

options = {}

if File.exists?(CONFIG_FILE)
  options.merge YAML.load_file(CONFIG_FILE)
end

shell = Capuchin::Shell.new(options)

default_command :build

command :build do |c|
  c.syntax = "capuchin build"
  c.description = "Parse all Markdown files in _emails/ and render to _output/"
  c.action do |args, options|
    shell.build
  end
end

command :schedule do |c|
  c.syntax = "capuchin schedule <path_to_email>"
  c.description = "Schedule an email to be sent via MailChimp"

  c.action do |args, options|
    shell.schedule(args.first)
  end
end